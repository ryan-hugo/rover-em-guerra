<!doctype html>
<html lang="pt-br">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Rover em Guerra ‚Äî Meta do Momento</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Abel&family=Bitcount+Single:wght@100..900&family=Manrope:wght@200..800&display=swap"
        rel="stylesheet">

    <style>
        :root {
            color-scheme: dark;
            --bg0: #040706;
            --bg1: #07110c;
            --panel: rgba(10, 16, 13, .70);
            --panel2: rgba(8, 12, 10, .55);
            --line: rgba(170, 210, 185, .14);
            --muted: rgba(230, 240, 234, .72);

            --accent: rgba(255, 196, 110, .95);
            --accent2: rgba(255, 140, 0, .70);

            --ok: rgba(0, 190, 130, .62);
            --warn: rgba(255, 90, 20, .80);
            --shadow: rgba(0, 0, 0, .46);
        }

        * {
            box-sizing: border-box;
            letter-spacing: 1.2px;
        }

        html,
        body {
            height: 100%
        }

        body {
            margin: 0;
            font-family: "Abel", sans-serif;
            font-weight: 100;
            font-style: normal;
            background:
                radial-gradient(1200px 700px at 16% 12%, rgba(255, 196, 110, 0.12), transparent 60%),
                radial-gradient(900px 600px at 86% 30%, rgba(0, 190, 130, 0.10), transparent 58%),
                linear-gradient(180deg, var(--bg1), var(--bg0));
            color: #eaf5ef;
        }

        .gridOverlay {
            position: fixed;
            inset: 0;
            pointer-events: none;
            background-image:
                linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 64px 64px;
            mask-image: radial-gradient(circle at 40% 20%, rgba(0, 0, 0, 1), rgba(0, 0, 0, 0.2) 60%, rgba(0, 0, 0, 0));
            opacity: .35;
        }

        .wrap {
            margin: 0 auto;
            padding: 18px 18px 26px
        }

        @media(max-width:900px) {
            .wrap {
                padding: 14px
            }
        }

        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            padding: 14px 18px;
            border-radius: 18px;
            border: 1px solid rgba(255, 255, 255, 0.04);
            background: linear-gradient(180deg, rgba(10, 14, 12, 0.55), rgba(8, 10, 9, 0.30));
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.6), inset 0 1px 0 rgba(255, 255, 255, 0.02);
            backdrop-filter: blur(8px) saturate(1.05);
            position: sticky;
            top: 12px;
            z-index: 40;
            border-left: 6px solid rgb(253, 188, 90);
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
            min-width: 280px;
        }

        .brand .logo {
            width: 64px;
            height: 64px;
            flex: 0 0 64px;
            border-radius: 12px;
            overflow: hidden;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(180deg, rgba(255, 196, 110, 0.06), rgba(0, 0, 0, 0.18));
            border: 1px solid rgba(255, 196, 110, 0.08);
            cursor: pointer;
        }

        .brand .logo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .brand .titleWrap {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .brand .title {
            display: block;
            font-weight: 950;
            font-size: 34px;
            line-height: 1;
            letter-spacing: 1.2px;
            text-transform: uppercase;
        }

        .brand .slogan {
            color: var(--muted);
            font-size: 13px;
            font-weight: 700;
            letter-spacing: 0.9px;
            opacity: 0.95;
        }

        .brand .subtitle {
            color: var(--muted);
            font-size: 13px;
        }

        .headRight {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: flex-end;
        }

        .pill {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 9px 12px;
            border-radius: 999px;
            border: 1px solid rgba(170, 210, 185, 0.16);
            background: rgba(0, 0, 0, 0.18);
            font-size: 12px;
            color: rgba(236, 246, 239, .78);
            white-space: nowrap;
        }

        .pill.ok {
            border-color: rgba(0, 190, 130, .30);
            background: rgba(0, 190, 130, .08)
        }

        .pill.warn {
            border-color: rgba(255, 90, 20, .30);
            background: rgba(255, 90, 20, .08)
        }

        .mono {
            font-family: "Abel", sans-serif;
            font-weight: 100;
            font-style: normal;
        }

        .btn {
            width: auto;
            padding: 10px 14px;
            border-radius: 8px;
            border: 0.6px solid rgba(255, 255, 255, 0.04);
            background: linear-gradient(180deg, rgb(253, 204, 131), rgb(250, 176, 86));
            font-weight: 900;
            letter-spacing: 1.6px;
            text-transform: uppercase;
            cursor: pointer;
            transition: transform .14s cubic-bezier(.2, .8, .2, 1), box-shadow .18s ease, color .12s ease;
            user-select: none;
            position: relative;
            overflow: visible;
        }

        .header .btn {
            padding: 10px 14px;
            border-radius: 10px;
            font-size: 13px;
            background: linear-gradient(180deg, #07110c, #04100e);
            border: none;
            box-shadow: none;
        }

        .header .btn:hover,
        .btn:hover {
            transform: translateY(-4px) scale(1.03);
            filter: drop-shadow(0 4px 10px rgba(255, 160, 40, 0.08));
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6), 0 0 18px rgba(255, 196, 110, 0.06);
            color: #fff;
            transition: transform .9s cubic-bezier(.2, .9, .2, 1);
        }

        .btn:active {
            transform: translateY(1px)
        }

        .btn.primary {
            background: linear-gradient(180deg, #ffd37a, #ffb24a);
            color: #1b1208;
            box-shadow: 0 8px 28px rgba(255, 180, 60, 0.12), 0 0 24px rgba(255, 160, 40, 0.06);
        }

        #btnTelao {
            background: linear-gradient(180deg, rgb(253, 204, 131), rgb(250, 176, 86));
            color: #eaf5ef;
            border: 1px solid rgba(255, 196, 110, 0.06);
            width: 44px;
            height: 44px;
            padding: 0;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
        }

        #btnTelao.primary,
        #btnTelao.active {
            background: linear-gradient(180deg, rgb(253, 204, 131), rgb(250, 176, 86));
            color: #23160b;
            box-shadow: 0 16px 40px rgba(255, 160, 40, 0.14), 0 0 32px rgba(255, 180, 60, 0.08);
            transform: translateY(-2px) scale(1.02);
        }

        #btnTelao .icon {
            display: inline-flex;
            transition: transform .25s ease;
            margin: 0;
        }

        #btnTelao.primary .icon {
            transform: rotate(-8deg) scale(1.06);
        }

        #btnTelao:hover .icon svg {
            filter: drop-shadow(0 4px 10px rgba(255, 160, 40, 0.08));
            transition: transform .18s ease, filter .18s ease;
            background: linear-gradient(180deg, #ffdd9f, #ffb56a);
        }

        #btnTelao:hover {
            background: linear-gradient(180deg, #ffdd9f, #ffb56a);
        }

        #btnTelao:focus {
            outline: 3px solid rgba(255, 246, 209, 0.904);
            outline-offset: 3px;
        }

        .btn .btnTooltip {
            position: absolute;
            top: -36px;
            left: 50%;
            transform: translateX(-50%) translateY(-8px) scale(0.9);
            transform-origin: bottom center;
            background: rgba(0, 0, 0, 0.7);
            color: #fff;
            padding: 6px 8px;
            border-radius: 8px;
            font-size: 12px;
            white-space: nowrap;
            pointer-events: none;
            opacity: 0;
            transition: opacity .12s ease, transform .12s ease;
            z-index: 60;
        }

        .btn:hover .btnTooltip {
            opacity: 1;
            transform: translateX(-50%) translateY(-10px) scale(1);
        }

        .header .btn {
            position: relative;
            overflow: hidden;
        }

        .header .btn::after {
            content: '';
            position: absolute;
            top: -40%;
            left: -40%;
            width: 40%;
            height: 180%;
            background: linear-gradient(120deg, rgba(255, 255, 255, 0) 0%, rgba(248, 240, 166, 0.938) 50%, rgb(253, 247, 153) 100%);
            transform: rotate(25deg) translateX(-100%);
            transition: transform .9s cubic-bezier(.2, .9, .2, 1);
            pointer-events: none;
        }

        .header .btn:hover::after {
            transform: rotate(25deg) translateX(300%);
        }

        .header .btn:active {
            transform: translateY(0) scale(0.995);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5) inset;
        }

        .layout {
            display: grid;
            grid-template-columns: minmax(360px, 520px) 1fr;
            gap: 14px;
            margin-top: 14px;
            align-items: start;
        }

        @media(max-width:1200px) {
            .layout {
                grid-template-columns: 1fr
            }
        }

        .card {
            border-radius: 18px;
            border: 1px solid var(--line);
            background: var(--panel);
            box-shadow: 0 16px 44px var(--shadow);
            backdrop-filter: blur(10px);
            overflow: hidden;
        }

        .cardHeader {
            padding: 16px 16px 10px;
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            gap: 10px;
            flex-wrap: wrap;
        }

        .cardTitle {
            margin: 0;
            font-size: 18px;
            font-weight: 950;
            letter-spacing: .2px
        }

        .cardDesc {
            color: var(--muted);
            font-size: 13px;
            margin-top: 6px;
            line-height: 1.25
        }

        .cardBody {
            padding: 12px 16px 16px
        }

        .divider {
            height: 1px;
            background: rgba(170, 210, 185, 0.12);
            margin: 12px 0
        }

        label {
            font-size: 12px;
            color: var(--muted);
            display: block;
            margin-bottom: 6px;
            letter-spacing: .35px;
            text-transform: uppercase
        }

        input,
        textarea,
        select {
            width: 100%;
            border-radius: 14px;
            border: 1px solid rgba(170, 210, 185, 0.16);
            background: rgba(0, 0, 0, 0.20);
            color: #eaf5ef;
            padding: 11px 12px;
            outline: none;
            font-size: 14px;
        }

        input:focus,
        textarea:focus,
        select:focus {
            border-color: rgba(255, 196, 110, .40);
            box-shadow: 0 0 0 3px rgba(255, 196, 110, .10);
        }

        textarea {
            min-height: 170px;
            resize: vertical
        }

        .row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px
        }

        @media(max-width:680px) {
            .row {
                grid-template-columns: 1fr
            }
        }

        .miniRow {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center
        }

        .miniRow .btn {
            padding: 10px 12px
        }

        .subCard {
            border-radius: 16px;
            border: 1px solid rgba(170, 210, 185, .14);
            background: rgba(0, 0, 0, .18);
            padding: 12px;
            box-shadow: inset 0 0 0 1px rgba(255, 255, 255, .03);
        }

        .subHead {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            margin-bottom: 10px;
        }

        .subHead h3 {
            margin: 0;
            font-size: 14px;
            font-weight: 950;
            letter-spacing: .4px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .hint {
            color: var(--muted);
            font-size: 12px;
            line-height: 1.25
        }

        .momentGrid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 12px;
            margin-top: 10px;
        }

        @media(max-width:1200px) {
            .momentGrid {
                grid-template-columns: 1fr 1fr
            }
        }

        @media(max-width:720px) {
            .momentGrid {
                grid-template-columns: 1fr
            }
        }

        .kpiCard {
            border-radius: 18px;
            border: 1px solid rgba(170, 210, 185, .14);
            background: linear-gradient(180deg, rgba(0, 0, 0, .18), rgba(0, 0, 0, .10));
            padding: 14px;
            box-shadow: inset 0 0 0 1px rgba(255, 255, 255, .03);
        }

        .kpiLabel {
            color: rgba(236, 246, 239, .68);
            font-size: 11px;
            letter-spacing: .5px;
            text-transform: uppercase
        }

        .kpiValue {
            font-size: 42px;
            font-weight: 1000;
            letter-spacing: .6px;
            margin-top: 6px
        }

        .kpiSub {
            color: var(--muted);
            font-size: 13px;
            margin-top: 6px;
            line-height: 1.25
        }

        .progress {
            height: 10px;
            border-radius: 999px;
            background: rgba(255, 255, 255, 0.06);
            overflow: hidden;
            border: 1px solid rgba(170, 210, 185, 0.10);
            margin-top: 10px;
        }

        .bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, rgba(255, 196, 110, .95), rgba(255, 140, 0, .72));
        }

        .leadersWrap {
            margin-top: 14px;
        }

        .leadersHeader {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            flex-wrap: wrap;
            margin: 6px 2px 10px;
        }

        .leadersHeader h2 {
            margin: 0;
            font-size: 16px;
            font-weight: 950
        }

        .leadersGrid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        @media(max-width:1200px) {
            .leadersGrid {
                grid-template-columns: 1fr
            }
        }

        .leaderCard {
            border-radius: 18px;
            border: 1px solid rgba(170, 210, 185, .14);
            background:
                radial-gradient(500px 220px at 15% 10%, rgba(255, 196, 110, .10), transparent 65%),
                linear-gradient(180deg, rgba(0, 0, 0, .18), rgba(0, 0, 0, .10));
            box-shadow: inset 0 0 0 1px rgba(255, 255, 255, .03);
            overflow: hidden;
        }

        .leaderCardHead {
            padding: 12px 14px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            flex-wrap: wrap;
            border-bottom: 1px solid rgba(170, 210, 185, .10);
            position: relative;
        }

        .leaderCardHead .tag {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            font-weight: 950;
            letter-spacing: .5px;
            text-transform: uppercase;
            font-size: 18px;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            justify-content: center;
            text-align: center;
            padding: 0;
            border: none;
            border-radius: 0;
            background: transparent;
            color: var(--accent);
            text-shadow: 0 1px 0 rgba(0, 0, 0, 0.6);
            max-width: calc(100% - 120px);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            z-index: 1;
        }

        .leaderCardHead .tag .icon {
            width: auto;
            height: auto;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border: none;
            background: transparent;
            box-shadow: none;
            font-size: 20px;
            line-height: 1;
        }

        .leaderCardHead .smallPill {
            padding: 7px 10px;
            border-radius: 999px;
            border: 1px solid rgba(170, 210, 185, .14);
            background: rgba(0, 0, 0, .18);
            color: rgba(236, 246, 239, .75);
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: .6px;
            white-space: nowrap;
            position: relative;
            z-index: 2;
        }

        @media (max-width: 520px) {
            .leaderCardHead {
                padding: 10px 12px;
            }

            .leaderCardHead .tag {
                position: static;
                transform: none;
                margin: 0 auto;
                font-size: 14px;
                max-width: 100%;
                background: transparent;
                border: none;
                color: var(--muted);
                box-shadow: none;
            }

            .leaderCardHead .tag .icon {
                width: 30px;
                height: 30px;
            }
        }

        .podium {
            display: grid;
            grid-template-columns: 1fr 1.25fr 1fr;
            gap: 10px;
            padding: 12px 14px 14px;
            align-items: end;
        }

        @media(max-width:520px) {
            .podium {
                grid-template-columns: 1fr;
                align-items: stretch
            }
        }

        .pod {
            border-radius: 16px;
            border: 1px solid rgba(170, 210, 185, .12);
            background: rgba(0, 0, 0, .18);
            padding: 12px;
            position: relative;
            min-height: 86px;
            box-shadow: inset 0 0 0 1px rgba(255, 255, 255, .02);
        }

        .pod.top1 {
            border-color: rgba(255, 196, 110, .38);
            background: linear-gradient(180deg, rgba(255, 196, 110, .12), rgba(0, 0, 0, .18));
            min-height: 108px;
            box-shadow: 0 18px 48px rgba(0, 0, 0, .55), inset 0 0 0 1px rgba(255, 255, 255, .03);
        }

        .rankBadge {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 34px;
            height: 34px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 1000;
            border: 1px solid rgba(170, 210, 185, .14);
            background: rgba(0, 0, 0, .18);
        }

        .top1 .rankBadge {
            border-color: rgba(255, 196, 110, .40);
            background: rgba(255, 196, 110, .10);
        }

        .podName {
            font-weight: 950;
            letter-spacing: .2px;
            margin-right: 44px;
            line-height: 1.15;
            font-size: 13px;
        }

        .trophy {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-right: 8px;
            color: #ffd37a;
            opacity: 0;
            transform: scale(0.2) translateY(6px);
            animation: trophy-pop 700ms cubic-bezier(.2, .9, .2, 1) forwards, trophy-float 3000ms ease-in-out 700ms infinite;
            position: relative;
        }

        .trophy::after {
            content: '';
            position: absolute;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255, 215, 120, 0.35) 0%, rgba(255, 180, 60, 0.12) 40%, rgba(255, 180, 60, 0) 70%);
            filter: blur(6px);
            opacity: 0;
            transform: scale(0.8);
            animation: trophy-glow 2200ms ease-in-out 900ms infinite;
            pointer-events: none;
        }

        @keyframes trophy-pop {
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        @keyframes trophy-float {
            0% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-6px);
            }

            100% {
                transform: translateY(0);
            }
        }

        @keyframes trophy-glow {
            0% {
                opacity: 0;
                transform: scale(0.9);
            }

            40% {
                opacity: 0.7;
                transform: scale(1.05);
            }

            100% {
                opacity: 0;
                transform: scale(0.9);
            }
        }

        .podSub {
            color: var(--muted);
            font-size: 11px;
            margin-top: 6px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }

        .podMetric {
            margin-top: 10px;
            font-size: 13px;
            font-weight: 950;
            letter-spacing: .2px;
            display: flex;
            align-items: baseline;
            justify-content: space-between;
            gap: 10px;
        }

        .podMetric small {
            color: var(--muted);
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: .6px;
            font-size: 10px
        }

        .tableWrap {
            margin-top: 14px;
            border-radius: 18px;
            border: 1px solid rgba(170, 210, 185, .14);
            background: rgba(0, 0, 0, .16);
            overflow: hidden;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px
        }

        th,
        td {
            padding: 10px 10px;
            border-bottom: 1px solid rgba(170, 210, 185, 0.10);
            text-align: left;
            white-space: nowrap
        }

        thead th {
            background: rgba(0, 0, 0, .22);
            color: rgba(236, 246, 239, .78);
            font-size: 11px;
            letter-spacing: .6px;
            text-transform: uppercase;
        }

        tbody tr:hover td {
            background: rgba(255, 196, 110, .04)
        }

        .not-found td {
            color: rgba(255, 90, 90, 1);
            background: rgba(255, 90, 90, 0.04);
        }

        .met td {
            color: rgba(0, 190, 130, 1);
            background: rgba(0, 190, 130, 0.04);
            font-weight: 800;
        }

        .metIcon {
            font-size: 14px;
            vertical-align: middle;
        }

        body.telao .wrap {
            max-width: 1800px
        }

        body.telao #leftCard {
            display: none;
        }

        body.telao .layout {
            grid-template-columns: 1fr;
        }

        #leftCard {
            transition: opacity 200ms ease, transform 200ms ease;
        }

        body.telao #leftCard {
            opacity: 0;
            transform: translateX(-8px);
        }

        .countdownOverlay {
            position: fixed;
            inset: 0;
            display: none;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, .70);
            backdrop-filter: blur(10px);
            z-index: 9999;
        }

        .countdownOverlay.show {
            display: flex
        }

        .countdownNum {
            font-size: min(22vw, 220px);
            font-weight: 1000;
            letter-spacing: 2px;
            text-shadow: 0 0 28px rgba(255, 196, 110, .22);
            color: rgba(255, 236, 210, .95);
            border: 1px solid rgba(255, 196, 110, .30);
            background: rgba(0, 0, 0, .25);
            border-radius: 24px;
            padding: 26px 34px;
            line-height: 1;
        }

        /* ========= PRODU√á√ÉO ========= */
        /* Bot√£o e √°rea "Resetar dados" fica oculto em produ√ß√£o */
        body.prod #btnReset {
            display: none !important;
        }

        /* Painel inteiro de PDF + Manual some em produ√ß√£o */
        body.prod [data-pane="pdf"] {
            display: none !important;
        }

        /* Em produ√ß√£o, bloqueia qualquer input/textarea/select da esquerda (Config) */
        body.prod #leftCard input,
        body.prod #leftCard textarea,
        body.prod #leftCard select,
        body.prod #leftCard button#btnStart {
            pointer-events: none;
            user-select: none;
            filter: grayscale(1);
            opacity: .55;
        }

        body.prod #leftCard .note::after {
            content: " (Bloqueado em produ√ß√£o)";
            opacity: .85;
        }

        /* P√≠lula nova do header: atualizado */
        .pill.update {
            border-color: rgba(255, 196, 110, .30);
            background: rgba(255, 196, 110, .06);
            color: rgba(255, 240, 220, .90);
        }

        /* FIX RESPONSIVIDADE ‚Äî L√≠deres (TEL√ÉO DESATIVADO) */
        body:not(.telao) .leadersGrid {
            grid-template-columns: repeat(2, minmax(320px, 1fr));
            gap: 12px;
        }

        @media (max-width: 1280px) {
            body:not(.telao) .leadersGrid {
                grid-template-columns: 1fr;
            }
        }

        body:not(.telao) .podium {
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            gap: 10px;
            align-items: stretch;
        }

        @media (max-width: 980px) {
            body:not(.telao) .podium {
                grid-template-columns: repeat(2, minmax(0, 1fr));
                align-items: stretch;
            }
        }

        @media (max-width: 560px) {
            body:not(.telao) .podium {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 980px) {
            body:not(.telao) .pod.top1 {
                grid-column: 1 / -1;
                min-height: 96px;
            }
        }

        body:not(.telao) .podName {
            margin-right: 44px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        @media (max-width: 560px) {
            body:not(.telao) .podName {
                white-space: normal;
                display: -webkit-box;
                -webkit-line-clamp: 2;
                -webkit-box-orient: vertical;
                margin-right: 0;
                padding-right: 44px;
            }
        }

        body:not(.telao) .rankBadge {
            width: 34px;
            height: 34px;
            flex: 0 0 auto;
        }

        body:not(.telao) .podMetric span {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            min-width: 0;
        }

        @media (max-width: 980px) {
            body:not(.telao) .pod {
                padding: 10px;
                min-height: 78px;
            }

            body:not(.telao) .pod.top1 {
                min-height: 90px;
            }

            body:not(.telao) .leaderCardHead {
                padding: 10px 12px;
            }

            body:not(.telao) .leaderCardHead .tag {
                font-size: 11px;
                letter-spacing: .45px;
            }
        }

        body:not(.telao) .leaderCard,
        body:not(.telao) .pod {
            min-width: 0;
        }
    </style>
</head>

<body>
    <div class="gridOverlay"></div>

    <div class="countdownOverlay" id="countdownOverlay" aria-hidden="true">
        <div class="countdownNum" id="countdownNum">10</div>
    </div>

    <div class="wrap">
        <div class="header">
            <div class="brand">
                <div class="logo" title="Rover em Guerra ‚Äî logomarca">
                    <img id="campaignLogo" src="" alt="logo" />
                </div>
                <div class="titleWrap">
                    <div class="title">ROVER EM GUERRA</div>
                    <div class="slogan">UMA GUERRA CONTRA OS PRE√áOS ALTOS</div>
                    <div class="subtitle">Importa PDF Winthor (315): <b>Cli.Posit</b> ‚Ä¢ <b>Mix</b> ‚Ä¢ <b>Vl Venda</b>
                    </div>
                    <!-- ‚úÖ NOVO: Status de atualiza√ß√£o -->
                    <div class="subtitle">
                        <span class="pill update mono" id="updatePill">üìå Atualizado: ‚Äî | hash: ‚Äî</span>
                    </div>
                </div>
            </div>

            <div class="headRight">
                <input id="logoInput" type="file" accept="image/*" style="display:none" />
                <span class="pill warn" id="statusPill">‚è±Ô∏è sem meta</span>

                <button class="btn" id="btnTelao" title="Alternar modo tel√£o" aria-pressed="false">
                    <span class="icon" aria-hidden="true">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"
                            focusable="false" aria-hidden="true">
                            <path d="M3 9V3h6" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"
                                stroke-linejoin="round" />
                            <path d="M21 15v6h-6" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"
                                stroke-linejoin="round" />
                            <path d="M14 3h7v7" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"
                                stroke-linejoin="round" />
                            <path d="M10 21H3v-7" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"
                                stroke-linejoin="round" />
                        </svg>
                    </span>
                    <span class="btnTooltip" aria-hidden="true">Entrar no modo tel√£o</span>
                </button>

                <button class="btn primary mono" id="btnReset">RESETAR DADOS</button>
            </div>
        </div>

        <div class="layout">
            <!-- LEFT -->
            <div class="card" id="leftCard">
                <div class="cardHeader">
                    <div>
                        <h2 class="cardTitle">Configura√ß√£o</h2>
                        <div class="cardDesc">
                            Em produ√ß√£o, edi√ß√£o manual e upload de PDF ficam bloqueados.
                        </div>
                    </div>
                    <div class="miniRow">
                        <button class="btn mono" id="btnStopAlarm">Parar alarme</button>
                        <button class="btn mono" id="btnClearLog">Limpar log</button>
                        <button class="btn mono" id="btnCopyLog">Copiar log</button>
                    </div>
                </div>

                <div class="cardBody">
                    <div class="divider"></div>

                    <div class="cfgPane active" data-pane="meta">
                        <div class="subCard">
                            <div class="subHead">
                                <h3>üéØ Meta</h3>
                                <span class="pill mono" id="metaModePill">preset</span>
                            </div>

                            <div class="row">
                                <div>
                                    <label>Preset</label>
                                    <select id="goalPreset">
                                        <option value="personalizada">Personalizada</option>
                                        <option value="meta3m">Meta 3 Milh√µes</option>
                                        <option value="metarelampago">Meta Rel√¢mpago</option>
                                    </select>
                                </div>
                                <div>
                                    <label>Nome</label>
                                    <input id="goalTitle" value="META REL√ÇMPAGO" />
                                </div>
                            </div>

                            <div class="row" style="margin-top:10px">
                                <div>
                                    <label>Meta do momento (R$)</label>
                                    <input id="goalValue" type="number" value="300000" />
                                </div>
                                <div></div>
                            </div>

                            <div class="row" style="margin-top:10px">
                                <div>
                                    <label>In√≠cio (data e hora)</label>
                                    <input id="goalStartDT" type="datetime-local" />
                                    <div class="note">Deixe vazio para come√ßar agora.</div>
                                </div>
                                <div>
                                    <label>Fim (data e hora) ‚Äî obrigat√≥rio</label>
                                    <input id="goalEndDT" type="datetime-local" />
                                </div>
                            </div>

                            <div class="row" style="margin-top:12px">
                                <button class="btn primary mono" id="btnStart" style="font-size: 22px;">Ativar</button>
                                <div class="note">
                                    ‚è≥ Faltando 10s: contagem gigante + beep suave por segundo. <br />
                                    üîî No fim: alarme suave por ~5s (para automaticamente).
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ‚úÖ EXISTE, mas ser√° oculto em produ√ß√£o via CSS (body.prod) -->
                    <div class="cfgPane" data-pane="pdf">
                        <div class="subCard">
                            <div class="subHead">
                                <h3>üìÑ PDF / Manual</h3>
                                <span class="pill mono" id="pdfStatusPill">PDF.js OFF</span>
                            </div>

                            <label>Importar PDF (315)</label>
                            <input id="pdfFile" type="file" accept="application/pdf" />

                            <div class="divider"></div>

                            <label>Entrada manual (RCA; VL VENDA; CLI.POSIT; MIX)</label>
                            <textarea id="rawData" placeholder="Ex:
39; 82708,77; 25; 103
12; 64666,76; 21; 136"></textarea>

                            <div class="row" style="margin-top:10px">
                                <button class="btn primary mono" id="btnParse"
                                    style="font-size:22px;">Processar</button>
                                <div>
                                    <label>Total vendido (manual, ref.)</label>
                                    <input id="soldNow" type="number" value="0" />
                                </div>
                            </div>

                            <div class="note" style="margin-top:10px">
                                Total principal = soma por RCA (PDF/manual). Vendedores zerados continuam aparecendo.
                            </div>
                        </div>
                    </div>

                    <div class="cfgPane" data-pane="log">
                        <div class="subCard">
                            <div class="subHead">
                                <h3>üßæ Log</h3>
                                <span class="pill mono">diagn√≥stico</span>
                            </div>
                            <textarea id="logBox" readonly class="mono" style="min-height:170px"></textarea>
                            <div class="note" style="margin-top:10px">
                                Em produ√ß√£o, os dados v√™m do servidor (public/data/latest.json).
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <!-- RIGHT -->
            <div class="card" id="rightCard" style="position:sticky; top:84px;">
                <div class="cardHeader">
                    <div>
                        <h2 class="cardTitle">DASHBOARD DE ACOMPANHAMENTO</h2>
                        <div class="cardDesc">L√≠deres + Snapshot + Tabela geral em uma √∫nica tela.</div>
                    </div>
                    <div class="miniRow">
                        <span class="pill mono" id="startHintPill">‚è≥ ‚Äî</span>
                        <span class="pill mono" id="rangePill">üìÖ ‚Äî</span>
                    </div>
                </div>

                <div class="cardBody">
                    <div class="momentGrid">
                        <div class="kpiCard">
                            <div class="kpiLabel">Vendido agora</div>
                            <div class="kpiValue" id="soldKpi">R$ 0,00</div>
                            <div class="kpiSub" id="pctKpi">0,0% da meta</div>
                            <div class="progress">
                                <div class="bar" id="bar"></div>
                            </div>
                        </div>

                        <div class="kpiCard">
                            <div class="kpiLabel">Tempo restante</div>
                            <div class="kpiValue mono" id="timeKpi">00:00:00</div>
                            <div class="kpiSub" id="timeSub">Sem meta ativa</div>
                            <div class="divider"></div>
                            <div class="miniRow" style="justify-content:space-between">
                                <div class="note"><b>In√≠cio</b> <span class="mono" id="startMini">‚Äî</span></div>
                                <div class="note"><b>Fim</b> <span class="mono" id="endMini">‚Äî</span></div>
                            </div>
                        </div>

                        <div class="kpiCard">
                            <div class="kpiLabel">Fonte / Integridade</div>
                            <div class="miniRow" style="margin-top:10px">
                                <span class="pill mono" id="sourceKpi">üìÑ base</span>
                                <span class="pill mono" id="updatedKpi">‚Äî</span>
                            </div>
                            <div class="kpiSub" style="margin-top:12px" id="integritySub">
                                Aguardando dados do servidor. Countdown 10s + alarme no fim.
                            </div>
                        </div>
                    </div>

                    <div class="leadersWrap">
                        <div class="leadersHeader">
                            <h2>L√≠deres do Momento</h2>
                            <span class="pill mono">Top 4 por categoria</span>
                        </div>
                        <div class="leadersGrid" id="leadersGrid"></div>
                    </div>

                    <div class="tableWrap">
                        <div style="display:flex; gap:12px; align-items:center; justify-content:space-between;">
                            <div class="tableSummary" id="tableSummary"
                                style="padding:10px 14px; display:flex; gap:12px; align-items:center;">
                                <span class="pill mono" id="summaryMet">‚úÖ Meta Batida: ‚Äî</span>
                                <span class="pill mono" id="summaryNotFound">‚ùå N√£o encontrados/sem venda: ‚Äî</span>
                            </div>
                            <div style="padding:8px 12px;">
                                <div class="nameFilterWrap"
                                    style="display:inline-flex; align-items:center; gap:8px; background:rgba(0,0,0,0.22); padding:6px 8px; border-radius:10px; border:1px solid rgba(255,255,255,0.04);">
                                    <input id="nameFilter" type="search" placeholder="Filtrar por nome (RCA/Vendedor)"
                                        style="background:transparent; border:none; color:inherit; padding:6px 8px; width:220px; outline:none; font-size:13px;" />
                                    <button type="button" class="nameFilterClear" id="nameFilterClear"
                                        aria-label="Limpar filtro"
                                        style="background:transparent; border:none; color:var(--muted); font-weight:900; cursor:pointer; padding:4px 8px; border-radius:8px;">√ó</button>
                                </div>
                            </div>
                        </div>

                        <table>
                            <thead>
                                <tr>
                                    <th>RCA</th>
                                    <th>Vendedor</th>
                                    <th>Vl Venda</th>
                                    <th>% Meta</th>
                                    <th>Cli.Posit</th>
                                    <th>Mix</th>
                                    <th>Meta</th>
                                </tr>
                            </thead>
                            <tbody id="tbody">
                                <tr>
                                    <td colspan="7" style="color:var(--muted)">Carregando base...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <script>
        // =========================================
        // ‚úÖ MODO PRODU√á√ÉO / DEV (controle simples)
        // -----------------------------------------
        // Produ√ß√£o = true: esconde upload de PDF, trava edi√ß√£o manual e trava start/reset pelo p√∫blico.
        // Dev = false: mant√©m tudo como antes.
        //
        // Para DEV:
        // - coloque PROD = false
        // ou
        // - acesse com ?dev=1
        // =========================================
        const FORCE_DEV = new URLSearchParams(location.search).get("dev") === "1";
        const PROD = !FORCE_DEV; // produ√ß√£o por padr√£o
        if (PROD) document.body.classList.add("prod");

        // ========= Logger cedo =========
        const logBox = document.getElementById("logBox");
        function log(msg) {
            const t = new Date().toLocaleTimeString();
            if (logBox) logBox.value = `[${t}] ${msg}\n` + logBox.value;
            console.log(`[${t}] ${msg}`);
        }

        // ========= Em produ√ß√£o: N√ÉO carregar PDF.js (n√£o precisa) =========
        (async () => {
            startApp(false, PROD ? "server-json" : "dev");
        })();

        function startApp(pdfOk, pdfSource) {
            // =======================
            // METAS PADR√ÉO (fixas)
            // =======================
            const META_PADRAO = new Map([
                ["39", 250000], ["12", 240000], ["297", 250000], ["180", 190000], ["42", 190000],
                ["51", 170000], ["167", 150000], ["38", 250000], ["233", 150000], ["314", 120000],
                ["232", 60000], ["186", 110000], ["209", 110000], ["101", 90000], ["198", 150000],
                ["227", 80000], ["217", 60000], ["223", 60000], ["219", 60000], ["224", 60000],
                ["218", 60000], ["211", 60000], ["298", 120000],
            ]);

            const NOME_PADRAO = new Map([
                ["39", "CLAUDIAMAR PAIXAO"], ["12", "VALCIR TRINDADE"], ["297", "PEDRO AZEVEDO"], ["180", "ANDRE JUNIOR DE SOUZA"],
                ["42", "ADRIANO JOSE SETTI RIBAS"], ["51", "FRANCISCO JOCELINO DA SILVA"], ["167", "EDSON LEITE DA SILVA"],
                ["38", "REGINALDO APARECIDO DE ALMEIDA"], ["233", "DENISSON ALVES DA SILVEIRA"], ["314", "MILTON RAMOS MARINHO"],
                ["232", "ALEX PONTES DA SILVA"], ["186", "ROBSON GUEDES BATISTA"], ["209", "EDUARDO MEDRADES DE SOUZA"],
                ["101", "MARCIA SENA"], ["198", "VOLNEY MACHADO"], ["227", "EVERTON CESAR LEVINSKI"],
                ["217", "FABIANO BATISTA DOS SANTOS"], ["223", "EBERSON SILVA DIAS"], ["219", "ADEMILSON ALVES"],
                ["224", "DIEGO VINICIUS ALMEIDA"], ["218", "SIMONE VIDAL"], ["211", "ELIZEU DE SOUZA SILVA"],
                ["298", "GABRIEL GOMES DE MACEDO"],
            ]);

            function baseRows() {
                const keys = Array.from(META_PADRAO.keys()).sort((a, b) => Number(a) - Number(b));
                return keys.map(rca => ({
                    rca,
                    name: NOME_PADRAO.get(rca) || `RCA ${rca}`,
                    meta: META_PADRAO.get(rca) || 0,
                    sales: 0,
                    cliPosit: 0,
                    mix: 0
                }));
            }

            function mergeIntoBase(extractedRows) {
                const base = baseRows();
                const map = new Map(base.map(r => [String(r.rca), { ...r, found: false }]));
                for (const e of (extractedRows || [])) {
                    const rca = String(e.rca || "").replace(/\D/g, "");
                    if (!rca) continue;
                    const t = map.get(rca);
                    if (t) {
                        t.sales = Number(e.sales) || 0;
                        t.cliPosit = Number(e.cliPosit) || 0;
                        t.mix = Number(e.mix) || 0;
                        t.found = true;
                        const nm = (e.name || "").trim();
                        if (nm) t.name = nm;
                    }
                }
                return Array.from(map.values()).sort((a, b) => Number(a.rca) - Number(b.rca));
            }

            // =======================
            // STATE
            // =======================
            const LS_KEY = "rover_em_guerra_state_final_v2";
            const defaultState = {
                goalTitle: "META REL√ÇMPAGO",
                goalValue: 300000,
                goalStart: null,
                goalEnd: null,
                source: "base",
                rows: baseRows(),
                lastUpdated: null,
                pdfHash: null,
                telao: false
            };

            let state;
            try {
                const raw = localStorage.getItem(LS_KEY);
                state = raw ? { ...defaultState, ...JSON.parse(raw) } : { ...defaultState };
                state.rows = mergeIntoBase(state.rows);
            } catch {
                state = { ...defaultState };
            }

            function saveState() { localStorage.setItem(LS_KEY, JSON.stringify(state)); }

            // =======================
            // DOM
            // =======================
            const el = id => document.getElementById(id);

            const goalPreset = el("goalPreset");
            const goalTitle = el("goalTitle");
            const goalValue = el("goalValue");
            const goalStartDT = el("goalStartDT");
            const goalEndDT = el("goalEndDT");
            const btnStart = el("btnStart");

            const btnReset = el("btnReset");
            const btnTelao = el("btnTelao");

            const btnStopAlarm = el("btnStopAlarm");
            const btnClearLog = el("btnClearLog");
            const btnCopyLog = el("btnCopyLog");

            const statusPill = el("statusPill");
            const soldKpi = el("soldKpi");
            const pctKpi = el("pctKpi");
            const bar = el("bar");

            const timeKpi = el("timeKpi");
            const timeSub = el("timeSub");
            const startMini = el("startMini");
            const endMini = el("endMini");

            const sourceKpi = el("sourceKpi");
            const updatedKpi = el("updatedKpi");
            const startHintPill = el("startHintPill");
            const rangePill = el("rangePill");
            const integritySub = el("integritySub");

            const tbody = el("tbody");
            const leadersGrid = el("leadersGrid");
            const nameFilterInput = el("nameFilter");
            const nameFilterClear = el("nameFilterClear");

            const metaModePill = el("metaModePill");
            const updatePill = el("updatePill");

            const countdownOverlay = el("countdownOverlay");
            const countdownNum = el("countdownNum");

            // =======================
            // Helpers
            // =======================
            const brl = n => (Number(n) || 0).toLocaleString("pt-BR", { style: "currency", currency: "BRL" });
            const clamp = (n, a, b) => Math.max(a, Math.min(b, n));
            const esc = s => String(s ?? "").replace(/[&<>"']/g, m => ({ "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;", "'": "&#39;" }[m]));
            const pctOver = (sales, meta) => (meta > 0 ? (sales / meta) * 100 : 0);

            function parseNum(s) {
                if (s == null) return 0;
                s = String(s).trim().replace("R$", "").replace(/\s+/g, "");
                const hasComma = s.includes(",");
                const hasDot = s.includes(".");
                if (hasComma) {
                    if (/(,\d{1,2})$/.test(s)) {
                        s = s.replace(/\./g, "");
                        s = s.replace(",", ".");
                    } else {
                        s = s.replace(/,/g, "");
                    }
                } else if (hasDot) {
                    if (!/\.\d{1,2}$/.test(s)) s = s.replace(/\./g, "");
                }
                const v = Number(s);
                return Number.isFinite(v) ? v : 0;
            }

            function parseLocalDT(val) {
                if (!val) return null;
                const d = new Date(val);
                return Number.isFinite(d.getTime()) ? d : null;
            }

            function formatDT(d) {
                if (!d) return "‚Äî";
                try { return new Date(d).toLocaleString("pt-BR", { hour12: false }); } catch { return "‚Äî"; }
            }

            function formatTimeLeft(ms) {
                const s = Math.max(0, Math.floor(ms / 1000));
                const hh = String(Math.floor(s / 3600)).padStart(2, "0");
                const mm = String(Math.floor((s % 3600) / 60)).padStart(2, "0");
                const ss = String(s % 60).padStart(2, "0");
                return `${hh}:${mm}:${ss}`;
            }

            // =======================
            // Countdown + Audio (mantido)
            // =======================
            const AudioCtx = window.AudioContext || window.webkitAudioContext;
            let audioCtx = null;
            let activeAudioNodes = [];
            let alarmTimerId = null;

            function ensureAudio() {
                if (!AudioCtx) return null;
                if (!audioCtx) audioCtx = new AudioCtx();
                if (audioCtx.state === "suspended") audioCtx.resume().catch(() => { });
                return audioCtx;
            }

            function stopAllAudioNow() {
                try {
                    activeAudioNodes.forEach(n => { try { n.stop?.(); } catch { } try { n.disconnect?.(); } catch { } });
                } finally { activeAudioNodes = []; }
                if (alarmTimerId) { clearTimeout(alarmTimerId); alarmTimerId = null; }
            }

            function playTone({ freq = 880, durationMs = 120, gain = 0.08, type = "sine", attackMs = 8, releaseMs = 60 } = {}) {
                const ctx = ensureAudio();
                if (!ctx) return;

                const osc = ctx.createOscillator();
                const g = ctx.createGain();
                osc.type = type;
                osc.frequency.value = freq;

                const t0 = ctx.currentTime;
                const dur = durationMs / 1000;
                const a = Math.max(0.001, attackMs / 1000);
                const r = Math.max(0.001, releaseMs / 1000);
                const t1 = t0 + dur;

                g.gain.setValueAtTime(0.0001, t0);
                g.gain.exponentialRampToValueAtTime(Math.max(0.0002, gain), t0 + a);
                g.gain.setValueAtTime(Math.max(0.0002, gain), Math.max(t0 + a, t1 - r));
                g.gain.exponentialRampToValueAtTime(0.0001, t1);

                osc.connect(g); g.connect(ctx.destination);
                osc.start(t0); osc.stop(t1 + 0.02);

                activeAudioNodes.push(osc, g);
                setTimeout(() => {
                    try { osc.disconnect(); } catch { }
                    try { g.disconnect(); } catch { }
                    activeAudioNodes = activeAudioNodes.filter(n => n !== osc && n !== g);
                }, durationMs + 120);
            }

            function beepCountdownTick() { playTone({ freq: 880, durationMs: 95, gain: 0.06, type: "sine", attackMs: 6, releaseMs: 55 }); }

            function startAlarm5s() {
                stopAllAudioNow();
                const ctx = ensureAudio();
                if (!ctx) return;
                const pattern = [{ f: 659, d: 140 }, { f: 880, d: 160 }, { f: 988, d: 180 }];
                let i = 0;
                const start = Date.now();
                const maxMs = 5000;
                function step() {
                    if (Date.now() - start >= maxMs) return;
                    const note = pattern[i % pattern.length];
                    playTone({ freq: note.f, durationMs: note.d, gain: 0.085, type: "triangle", attackMs: 10, releaseMs: 90 });
                    i++;
                    alarmTimerId = setTimeout(step, 260);
                }
                step();
            }

            function stopAlarm() { stopAllAudioNow(); }

            let overlayActive = false;
            let lastOverlaySecond = null;

            function showCountdownSeconds(sec) {
                countdownNum.textContent = String(sec);
                countdownOverlay.classList.add("show");
                countdownOverlay.setAttribute("aria-hidden", "false");
            }

            function hideCountdown() {
                countdownOverlay.classList.remove("show");
                countdownOverlay.setAttribute("aria-hidden", "true");
            }

            function resetFinalCountdownState() {
                overlayActive = false; lastOverlaySecond = null; hideCountdown();
            }

            function updateFinalCountdown(msLeft) {
                const secLeft = Math.ceil(msLeft / 1000);
                if (secLeft >= 1 && secLeft <= 10) {
                    overlayActive = true;
                    showCountdownSeconds(secLeft);
                    if (lastOverlaySecond !== secLeft) {
                        lastOverlaySecond = secLeft;
                        beepCountdownTick();
                    }
                } else {
                    if (overlayActive) resetFinalCountdownState();
                }
            }

            // =======================
            // Presets
            // =======================
            function applyPreset(val) {
                if (val === "meta3m") {
                    goalTitle.value = "META 3 MILH√ïES";
                    goalValue.value = 3000000;
                    metaModePill.textContent = "preset";
                } else if (val === "metarelampago") {
                    goalTitle.value = "META REL√ÇMPAGO";
                    goalValue.value = 300000;
                    metaModePill.textContent = "preset";
                } else {
                    metaModePill.textContent = "personalizada";
                }
            }
            goalPreset.addEventListener("change", () => applyPreset(goalPreset.value));

            // =======================
            // ‚úÖ NOVO: carregar JSON do servidor (public/data/latest.json)
            // =======================
            async function loadServerLatest() {
                try {
                    const res = await fetch(`/data/latest.json?ts=${Date.now()}`, { cache: "no-store" });
                    if (!res.ok) throw new Error(`HTTP ${res.status}`);
                    const payload = await res.json();
                    if (!payload?.rows?.length) throw new Error("JSON sem rows");

                    state.rows = mergeIntoBase(payload.rows);
                    state.source = "pdf";
                    state.lastUpdated = payload.generatedAt || new Date().toISOString();
                    state.pdfHash = payload.pdfHash || null;

                    saveState();
                    render();
                    log(`Servidor: carregou latest.json (${payload.rows.length} RCAs). Hash ${payload.pdfHash || "-"}`);
                } catch (e) {
                    log(`Servidor: n√£o carregou latest.json (${e.message}). Mantendo localStorage/base.`);
                    render();
                }
            }

            // =======================
            // Render
            // =======================
            let timerTickId = null;
            let endedAlarmFired = false;

            function render() {
                document.body.classList.toggle("telao", !!state.telao);
                btnTelao.classList.toggle("primary", !!state.telao);

                btnTelao.setAttribute('aria-pressed', !!state.telao ? 'true' : 'false');
                btnTelao.title = state.telao ? 'Sair do modo tel√£o' : 'Entrar no modo tel√£o';
                const tt = document.querySelector('#btnTelao .btnTooltip');
                if (tt) tt.textContent = state.telao ? 'Sair do modo tel√£o' : 'Entrar no modo tel√£o';

                goalTitle.value = state.goalTitle ?? goalTitle.value;
                goalValue.value = state.goalValue ?? goalValue.value;

                if (state.goalStart) {
                    const d = new Date(state.goalStart);
                    goalStartDT.value = d.toISOString().slice(0, 16);
                } else goalStartDT.value = "";

                if (state.goalEnd) {
                    const d = new Date(state.goalEnd);
                    goalEndDT.value = d.toISOString().slice(0, 16);
                } else goalEndDT.value = "";

                // Header update pill
                const upd = state.lastUpdated ? new Date(state.lastUpdated).toLocaleString("pt-BR", { hour12: false }) : "‚Äî";
                const hash = state.pdfHash ? String(state.pdfHash) : "‚Äî";
                if (updatePill) updatePill.textContent = `üìå Atualizado: ${upd} | hash: ${hash}`;

                const now = Date.now();
                let pillTxt = "‚è±Ô∏è sem meta";
                let pillCls = "pill warn";

                if (state.goalEnd) {
                    const s = state.goalStart ? new Date(state.goalStart).getTime() : now;
                    const e = new Date(state.goalEnd).getTime();

                    const startLabel = state.goalStart ? new Date(state.goalStart) : null;
                    const endLabel = new Date(state.goalEnd);

                    rangePill.textContent = `üìÖ ${formatDT(startLabel || new Date())} ‚Üí ${formatDT(endLabel)}`;

                    if (now < s) { pillTxt = "‚è≥ aguardando in√≠cio"; pillCls = "pill warn"; }
                    else if (now >= s && now < e) { pillTxt = `ü™ñ ativa`; pillCls = "pill ok"; }
                    else { pillTxt = "‚ö†Ô∏è encerrada"; pillCls = "pill warn"; }
                } else {
                    rangePill.textContent = "üìÖ ‚Äî";
                }

                statusPill.className = pillCls;
                statusPill.textContent = pillTxt;

                const total = (state.rows || []).reduce((a, r) => a + (Number(r.sales) || 0), 0);
                const metaMom = Number(state.goalValue) || 0;
                const p = metaMom > 0 ? (total / metaMom) * 100 : 0;
                soldKpi.textContent = brl(total);
                pctKpi.textContent = metaMom > 0 ? `${p.toFixed(1)}% da meta (${brl(metaMom)})` : "Defina a meta do momento";
                bar.style.width = `${clamp(p, 0, 100)}%`;

                sourceKpi.textContent = state.source === "pdf" ? "üìÑ servidor" : "üìÑ base";
                sourceKpi.className = `pill mono ${state.source === "pdf" ? "ok" : "warn"}`;

                updatedKpi.textContent = state.lastUpdated ? `‚è±Ô∏è ${new Date(state.lastUpdated).toLocaleTimeString()}` : "‚Äî";
                startHintPill.textContent = state.goalStart ? `‚è≥ come√ßa ${new Date(state.goalStart).toLocaleTimeString()}` : "‚è≥ come√ßa agora";

                const sorted = [...(state.rows || [])].sort((a, b) => (b.sales || 0) - (a.sales || 0));
                const filterText = (state.nameFilter || "").trim().toLowerCase();

                let countMet = 0;
                let countNotFoundOrZero = 0;

                const filteredRows = sorted.filter(r => {
                    if (!filterText) return true;
                    const hay = (`${r.rca || ''} ${r.name || ''}`).toLowerCase();
                    return hay.indexOf(filterText) !== -1;
                });

                tbody.innerHTML = filteredRows.map(r => {
                    const pm = pctOver(r.sales, r.meta || 0);
                    const reachedMeta = (Number(r.sales) || 0) >= (Number(r.meta) || 0) && (Number(r.meta) || 0) > 0;
                    const notFound = (state.source === "pdf" && r.found === false);

                    if (reachedMeta) countMet++;
                    if (notFound || (Number(r.sales) || 0) === 0) countNotFoundOrZero++;

                    const rowClass = notFound ? 'not-found' : (reachedMeta ? 'met' : '');
                    const checkHtml = reachedMeta && !notFound ? `<span class="metIcon">‚úÖ</span>&nbsp;` : '';

                    return `<tr class="${rowClass}">
            <td>${esc(r.rca)}</td>
            <td>${checkHtml}${esc(r.name)}</td>
            <td>${brl(r.sales)}</td>
            <td>${pm.toFixed(1)}%</td>
            <td>${Number(r.cliPosit || 0)}</td>
            <td>${Number(r.mix || 0)}</td>
            <td>${brl(r.meta || 0)}</td>
          </tr>`;
                }).join("");

                const summaryMetEl = document.getElementById('summaryMet');
                const summaryNotFoundEl = document.getElementById('summaryNotFound');
                if (summaryMetEl) summaryMetEl.textContent = `‚úÖ Meta Batida: ${countMet}`;
                if (summaryNotFoundEl) summaryNotFoundEl.textContent = `‚ùå N√£o encontrados/sem venda: ${countNotFoundOrZero}`;

                renderLeaders(filteredRows);

                integritySub.textContent = PROD
                    ? "Produ√ß√£o: dados v√™m do servidor (latest.json). Edi√ß√£o manual e upload bloqueados."
                    : "DEV: voc√™ pode editar e testar manualmente (use ?dev=1).";
            }

            function leaderCard(title, icon, rows, metricLabel, metricFn) {
                const r1 = rows[0] || null;
                const r2 = rows[1] || null;
                const r3 = rows[2] || null;
                const r4 = rows[3] || null;

                function podHTML(rank, r, extraCls) {
                    const cls = `pod ${extraCls || ""}`.trim();
                    if (!r) {
                        return `<div class="${cls}">
              <div class="rankBadge">${rank}</div>
              <div class="podName mono" style="color:var(--muted)">‚Äî</div>
              <div class="podSub"><span class="mono">RCA ‚Äî</span></div>
              <div class="podMetric"><span style="color:var(--muted)">‚Äî</span><small>${esc(metricLabel)}</small></div>
            </div>`;
                    }

                    const trophyHtml = extraCls && extraCls.indexOf('top1') !== -1 ? `
            <span class="trophy" aria-hidden="true">
              <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                <path d="M8 2h8v2a3 3 0 0 1-3 3H11A3 3 0 0 1 8 4V2z" fill="currentColor" opacity="0.95"/>
                <path d="M6 6H4a2 2 0 0 0-2 2v1a5 5 0 0 0 4 4.9V16a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2v-2.1A5 5 0 0 0 22 9V8a2 2 0 0 0-2-2h-2" stroke="currentColor" stroke-width="0.8" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M9 20h6v2H9v-2z" fill="currentColor" opacity="0.95"/>
                <circle cx="18.5" cy="7.5" r="1.2" fill="currentColor" opacity="0.9"/>
              </svg>
            </span>` : '';

                    return `<div class="${cls}">
            <div class="rankBadge">${rank}</div>
            <div class="podName">${trophyHtml}${esc(r.name)}</div>
            <div class="podSub"><span class="mono">RCA ${esc(r.rca)}</span></div>
            <div class="podMetric"><span>${esc(metricFn(r))}</span><small>${esc(metricLabel)}</small></div>
          </div>`;
                }

                return `
          <div class="leaderCard">
            <div class="leaderCardHead">
              <div class="tag">
                <span class="icon">${icon}</span>
                <span>${title}</span>
              </div>
              <span class="smallPill">TOP 4</span>
            </div>
            <div class="podium">
              ${podHTML(2, r2, "")}
              ${podHTML(1, r1, "top1")}
              ${podHTML(3, r3, "")}
            </div>
            <div style="padding:0 14px 14px">
              <div class="pod" style="min-height:auto">
                <div class="rankBadge">4</div>
                <div class="podName">${r4 ? esc(r4.name) : '<span style="color:var(--muted)">‚Äî</span>'}</div>
                <div class="podSub">${r4 ? `<span class="mono">RCA ${esc(r4.rca)}</span>` : '<span class="mono">RCA ‚Äî</span>'}</div>
                <div class="podMetric">
                  <span>${r4 ? esc(metricFn(r4)) : '<span style="color:var(--muted)">‚Äî</span>'}</span>
                  <small>${esc(metricLabel)}</small>
                </div>
              </div>
            </div>
          </div>
        `;
            }

            function renderLeaders(filteredRows) {
                const sourceRows = Array.isArray(filteredRows) ? filteredRows : (state.rows || []);
                function top4ByFn(fn) { return [...sourceRows].sort((a, b) => fn(b) - fn(a)).slice(0, 4); }

                const volume = top4ByFn(r => Number(r.sales) || 0);
                const pct = top4ByFn(r => pctOver(r.sales, r.meta || 0));
                const pos = top4ByFn(r => Number(r.cliPosit) || 0);
                const mix = top4ByFn(r => Number(r.mix) || 0);

                leadersGrid.innerHTML = [
                    leaderCard("Maior volume de vendas", "üí•", volume, "Vl venda", r => brl(r.sales)),
                    leaderCard("Maior % sobre meta", "üéØ", pct, "% meta", r => `${pctOver(r.sales, r.meta || 0).toFixed(1)}%`),
                    leaderCard("Maior positiva√ß√£o", "ü™ñ", pos, "Cli.posit", r => String(Number(r.cliPosit || 0))),
                    leaderCard("Maior mix", "üß®", mix, "Mix", r => String(Number(r.mix || 0))),
                ].join("");
            }

            // =======================
            // Timer loop
            // =======================
            function startTimerLoop() {
                if (timerTickId) clearInterval(timerTickId);
                timerTickId = setInterval(() => {
                    const now = Date.now();

                    if (!state.goalEnd) {
                        timeKpi.textContent = "00:00:00";
                        timeSub.textContent = "Sem meta ativa";
                        startMini.textContent = "‚Äî";
                        endMini.textContent = "‚Äî";
                        resetFinalCountdownState();
                        endedAlarmFired = false;
                        return;
                    }

                    const endMs = new Date(state.goalEnd).getTime();
                    const startMs = state.goalStart ? new Date(state.goalStart).getTime() : now;

                    startMini.textContent = state.goalStart ? new Date(state.goalStart).toLocaleString("pt-BR", { hour12: false }) : "agora";
                    endMini.textContent = new Date(state.goalEnd).toLocaleString("pt-BR", { hour12: false });

                    if (now < startMs) {
                        timeKpi.textContent = formatTimeLeft(startMs - now);
                        timeSub.textContent = "Aguardando in√≠cio";
                        resetFinalCountdownState();
                        endedAlarmFired = false;
                        return;
                    }

                    const msLeft = endMs - now;
                    if (msLeft > 0) {
                        timeKpi.textContent = formatTimeLeft(msLeft);
                        timeSub.textContent = "Tempo restante";
                        endedAlarmFired = false;
                        updateFinalCountdown(msLeft);
                    } else {
                        timeKpi.textContent = "00:00:00";
                        timeSub.textContent = "Encerrado";
                        resetFinalCountdownState();

                        if (!endedAlarmFired) {
                            endedAlarmFired = true;
                            startAlarm5s();
                            log("‚è∞ Meta encerrada: alarme suave por ~5s.");
                        }
                    }
                }, 200);
            }

            // =======================
            // Intera√ß√µes (bloqueadas em produ√ß√£o)
            // =======================
            btnTelao.addEventListener("click", () => {
                state.telao = !state.telao;
                saveState();
                render();
            });

            btnStopAlarm.addEventListener("click", () => { stopAlarm(); log("Alarme interrompido."); });
            btnClearLog.addEventListener("click", () => { logBox.value = ""; log("Log limpo."); });
            btnCopyLog.addEventListener("click", async () => {
                try { await navigator.clipboard.writeText(logBox.value || ""); log("Log copiado para a √°rea de transfer√™ncia."); }
                catch { alert("N√£o foi poss√≠vel copiar automaticamente. Selecione e copie manualmente."); }
            });

            // Filtro por nome (p√∫blico, pode)
            if (nameFilterInput) {
                nameFilterInput.value = state.nameFilter || "";
                nameFilterInput.addEventListener('input', (e) => {
                    state.nameFilter = e.target.value;
                    saveState();
                    render();
                });
                nameFilterInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        nameFilterInput.value = '';
                        state.nameFilter = '';
                        saveState();
                        render();
                    }
                });
                if (nameFilterClear) {
                    nameFilterClear.addEventListener('click', () => {
                        nameFilterInput.value = '';
                        state.nameFilter = '';
                        saveState();
                        render();
                        nameFilterInput.focus();
                    });
                }
            }

            // S√≥ no DEV libera Start/Reset
            if (!PROD) {
                btnStart.addEventListener("click", () => {
                    ensureAudio();

                    const title = goalTitle.value.trim() || "META";
                    const val = parseNum(goalValue.value);

                    const startD = parseLocalDT(goalStartDT.value);
                    const endD = parseLocalDT(goalEndDT.value);

                    if (!endD) { alert("O FIM (data e hora) √© obrigat√≥rio."); return; }
                    const start = startD ? startD : new Date();
                    if (endD.getTime() <= start.getTime()) { alert("O FIM precisa ser maior que o IN√çCIO."); return; }

                    state.goalTitle = title;
                    state.goalValue = val;
                    state.goalStart = start.toISOString();
                    state.goalEnd = endD.toISOString();
                    saveState();
                    render();
                    startTimerLoop();
                    log(`Meta ativada: "${state.goalTitle}" (${brl(state.goalValue)})`);
                });

                btnReset.addEventListener("click", () => {
                    state = { ...defaultState, rows: baseRows(), telao: state.telao };
                    saveState();
                    if (logBox) logBox.value = "";
                    render();
                    startTimerLoop();
                    log("Reset conclu√≠do. Base restaurada.");
                });
            } else {
                // Produ√ß√£o: evita qualquer tentativa (caso algu√©m force via DevTools)
                btnStart.addEventListener("click", (e) => { e.preventDefault(); log("Produ√ß√£o: edi√ß√£o bloqueada."); });
                btnReset.addEventListener("click", (e) => { e.preventDefault(); log("Produ√ß√£o: reset bloqueado."); });
            }

            // =======================
            // Init
            // =======================
            applyPreset(goalPreset.value);
            if (typeof state.telao === "boolean") document.body.classList.toggle("telao", state.telao);

            render();
            startTimerLoop();
            loadServerLatest(); // ‚úÖ pega latest.json e atualiza tudo

            log(`Sistema pronto. Modo: ${PROD ? "PRODU√á√ÉO" : "DEV"} | Fonte: ${pdfSource}`);

            // --- Logo upload handling (continua p√∫blico) ---
            const logoInput = document.getElementById('logoInput');
            const logoContainer = document.querySelector('.brand .logo');
            const campaignLogo = document.getElementById('campaignLogo');

            try {
                const savedLogo = localStorage.getItem('rover_logo_dataurl_v1');
                if (savedLogo) campaignLogo.src = savedLogo;
            } catch { }

            if (logoContainer && logoInput && campaignLogo) {
                try { logoContainer.style.cursor = 'pointer'; } catch { }
                logoContainer.addEventListener('click', () => logoInput.click());

                logoInput.addEventListener('change', async (e) => {
                    const f = e.target.files?.[0];
                    if (!f) return;
                    handleLogoFile(f, campaignLogo, logoInput);
                });
            }

            async function handleLogoFile(file, imgEl, inputEl) {
                try {
                    const processed = await compressToDataURL(file, 128, 0.8);
                    if (processed) {
                        imgEl.src = processed;
                        try { localStorage.setItem('rover_logo_dataurl_v1', processed); } catch { }
                        if (inputEl) inputEl.value = '';
                    }
                } catch (err) {
                    console.error('Logo processing failed', err);
                }
            }

            function compressToDataURL(file, maxSizePx, quality) {
                return new Promise((resolve) => {
                    const reader = new FileReader();
                    reader.onload = () => {
                        const img = new Image();
                        img.onload = () => {
                            const canvas = document.createElement('canvas');
                            const ratio = Math.min(1, maxSizePx / Math.max(img.width, img.height));
                            canvas.width = Math.round(img.width * ratio);
                            canvas.height = Math.round(img.height * ratio);
                            const ctx = canvas.getContext('2d');
                            ctx.clearRect(0, 0, canvas.width, canvas.height);
                            ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                            try {
                                const dataUrl = canvas.toDataURL('image/jpeg', quality);
                                resolve(dataUrl);
                            } catch { resolve(null); }
                        };
                        img.onerror = () => resolve(null);
                        img.src = reader.result;
                    };
                    reader.onerror = () => resolve(null);
                    reader.readAsDataURL(file);
                });
            }
        }
    </script>
</body>

</html>